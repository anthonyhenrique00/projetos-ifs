
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cadastro de Produtos - MercadoAgroIFS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<nav class="navbar navbar-expand-lg bg-light">
  <div class="container">
    <a class="navbar-brand" href="index.html"><span>MercadoAgroIFS</span></a>
    <div>
      <a href="cliente.html" class="btn btn-sm btn-ifs">Loja</a>
    </div>
  </div>
</nav>

<main class="container py-4">
  <h2 class="mb-3">Cadastro (carregamento de estoque)</h2>
  <div class="alert alert-success">Use o botão <strong>Carregar estoque.json</strong> para ler um arquivo. Você também pode clicar em <em>Carregar padrão</em> para usar o arquivo <code>./estoque.json</code> do projeto. O conteúdo carregado <u>aparece abaixo</u>.</div>

  <div class="d-flex gap-2 mb-3">
    <input type="file" class="form-control" id="arquivoEstoque" accept=".json">
    <button class="btn btn-outline-secondary" id="btnCarregarUpload">Carregar estoque.json</button>
    <button class="btn btn-ifs" id="btnCarregarPadrao">Carregar padrão</button>
  </div>

  <div id="status" class="mb-3 text-success fw-semibold"></div>

  <div class="table-responsive">
    <table class="table table-striped align-middle" id="tabelaEstoque">
      <thead>
        <tr>
          <th>#</th>
          <th>Nome</th>
          <th>Descrição</th>
          <th>Peso (kg)</th>
          <th>Qtd estoque</th>
          <th>Preço (R$)</th>
          <th>Dias entrega</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="text-end">
    <button class="btn btn-outline-dark" id="btnBaixarEstoque">Baixar estoque atual (JSON)</button>
  </div>
</main>

<script src="mercadoagro.js"></script>
<script>
const corpo = document.querySelector('#tabelaEstoque tbody');
const statusBox = document.getElementById('status');

function renderTabela(lista){
  corpo.innerHTML = '';
  lista.forEach((p, i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${p.nome}</td>
      <td>${p.descricao}</td>
      <td>${p.peso}</td>
      <td><span class="badge bg-success">${p.quantidade}</span></td>
      <td>${p.preco.toFixed(2)}</td>
      <td>${p.dias_entrega}</td>
    `;
    corpo.appendChild(tr);
  });
  statusBox.textContent = 'Estoque carregado e exibido.';
}

document.getElementById('btnCarregarUpload').addEventListener('click', async ()=>{
  const file = document.getElementById('arquivoEstoque').files[0];
  if(!file){ alert('Selecione um arquivo .json'); return; }
  try{
    const data = await lerEstoqueDeUpload(file);
    renderTabela(data);
  }catch(e){
    alert('Erro ao ler JSON: ' + e.message);
  }
});

document.getElementById('btnCarregarPadrao').addEventListener('click', async ()=>{
  try{
    const data = await carregarEstoqueDeArquivo('./estoque.json');
    renderTabela(data);
  }catch(e){
    alert(e.message);
  }
});

document.getElementById('btnBaixarEstoque').addEventListener('click', ()=>{
  const atual = getEstoque();
  if(!atual){ alert('Nenhum estoque em memória para baixar. Carregue primeiro.'); return; }
  baixarJSON('estoque-atualizado.json', atual);
});


(function init(){
  const existente = getEstoque();
  if(existente){ renderTabela(existente); }
})();
</script>
</body>
</html>
